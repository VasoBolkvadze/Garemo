extends ../index.jade
include ../mixins/basic-controls.jade
include ../mixins/form-controls.jade
include ../mixins/grid-controls.jade

block content
	div(ng-controller='axaliCtrl')
		script.
				var axaliCtrl = function($scope, $modal, $log){
					$scope.atvisebisGegmaColumns = [];
					$scope.resursebi = [
						{dasaxeleba:'',raodenoba:0,zomisErteuli:null,gamokenebisSfero:''}
					];
					$scope.gegmaItems = [
						{celi:'',odenoba:0}
					];
					$scope.addResursi = function(){
						$scope.resursebi.push({dasaxeleba:'',raodenoba:0,zomisErteuli:null,gamokenebisSfero:''});
					};
					$scope.addAtvisebisGegmaColumn = function(){
						$scope.atvisebisGegmaColumns.push({});
					};
					//					$scope.removeAtvisebisGegmaColumn = function(agc){
					//						var i = $scope.atvisebisGegmaColumns.indexOf(agc);
					//						$scope.atvisebisGegmaColumns.splice(i,1);
					//					};
					$scope.addGegmaItem = function(){
						$scope.gegmaItems.push({celi:'',odenoba:0});
					};
					$scope.removeResursi = function(res){
						var i = $scope.resursebi.indexOf(res);
						$scope.resursebi.splice(i,1);
					};
					$scope.removeGegmaItem = function(gi){
						var i = $scope.gegmaItems.indexOf(gi);
						$scope.gegmaItems.splice(i,1);
					};
					$scope.open = function () {
							var modalInstance = $modal.open({
									templateUrl: '/templates/licenziebi/carmomadgeneli.jade',
									controller: modalInstanceCtrl
							});
							modalInstance
								.result
								.then(function (selectedItem) {
									$scope.selected = selectedItem;
								}
								, function () {
									$log.info('Modal dismissed at: ' + new Date());
							});
					};
				};
				var modalInstanceCtrl = function ($scope, $modalInstance) {
						$scope.ok = function () {
							$modalInstance.close();
						};
						$scope.cancel = function () {
							$modalInstance.dismiss('cancel');
						};
				};
		.jumbotron.jumbotron-sm
			.container
				.row
					.col-sm-12.col-lg-12
						h2.txt-capital ახალი ლიცენზია
		.container
			.row
				form.form-horizontal(method='POST',enctype='multipart/form-data')
					div.col-md-12
						+panel('ლიცენზიანტის მონაცემები',4)
							+textbox('pid','საიდენთიფიკაციო კოდი','ან ფიზიკური პირის პირადი ნომერი',true)
							+textbox('dasaxeleba','დასახელება','ან ფიზიკური პირის სახელი, გვარი',true)
							+textbox('fakMisamarti','ფაქტიური მისამართი','მაგ: წერეთლის #144',true)
							+textbox('iurMisamarti','იურიდიული მისამართი','მაგ: წერეთლის #144',true)
							+specInput('phone','phone','phone','ტელეფონი','მაგ: 599123456',true)
							+specInput('email','email','envelope','e-ფოსტა','მაგ: someone@mail.com',true)
							+fileUpload('mibmuliFailebi','*',true,'მიბმული ფაილები',true)
						hr
						a.btn.btn-default.txt-capital(ng-click='open()') წარმომადგენელი პირი
						hr
						+panel('ინფორმაცია ობიექტის შესახებ',4)
							div.col-md-6
								+typeahead('regioni',regionebi,'რეგიონი')
								+typeahead('municipaliteti',municipalitetebi,'მუნიციპალიტეტი')
								+textbox('dasaxlebuliPunkti','დასახლებული პუნქტი','',true)
							div.col-md-6
								+combobox('fartobiUom',fartobiUoms,'ფართობის საზომი ერთეული',true)
								+numberbox('fartobi','ფართობი','',true)
							div.col-md-12
								+panel('რესურსები')
									table.table.table-hover.table-bordered.table-condensed
										thead
											tr.txt-capital
												th(width='37%') დასახელება
												th(width='10%') რაოდენობა
												th(width='15%') ზომის ერთეული
												th(width='35%') გამოყენების სფერო
												th(width='3%')
										tbody
											tr(ng-repeat='res in resursebi')
												td
													+textcell('resursisDasaxeleba',true)
												td
													+numbercell('resursisRaodenoba',true)
												td
													+combocell('resursisUom',uoms,'',true)
												td
													+textcell('gamokenebisSfero',true)
												td
													a.btn.btn-sm.btn-danger.pull-right(ng-click='removeResursi(res)') X
											tr
												td(colspan='4')
												td
													a.btn.btn-sm.btn-success.pull-right(ng-click='addResursi()') +
						+panel('ინფორმაცია ლიცენზიის შესახებ',4)
							+textbox('licenziisNomeri','ლიცენზიის N','',true)
							+datepicker('licenziisGacemisTarigi','გაცემის თარიღი',true)
							+textbox('brdzanebisNomeri','ბრძანების N','',true)
							+datepicker('brdzanebisTarigi','ბრძანების თარიღი',true)
							+numberbox('moqmedebisVada','მოქმედების ვადა','წლებში (მაგ: 5)',true)
							+bigtext('salicenzioPirobebi',5,10,'სალიცენზიო პირობები')
							+combobox('licenziisStatusi',statusebi,'ლიცენზიის სტატუსი',true)
							+fileUpload('licenziaFailebi','*',true,'ფაილები',true)
						+panel('დამატებითი ინფორმაცია',4)
							+fileUpload('ruqa','image/*',true,'რუქა',true)
							+numberbox('a','a','',true)
							+numberbox('b','b','',true)
							+numberbox('c1','c1','',true)
							+numberbox('c2','c2','',true)
							+numberbox('p','p','',true)
							+fileUpload('geoSainformacioPaketi','*',true,'გეოსაინფორმაციო პაკეტი',true)
							+radio('regulirebisGadamxdeli',['კი','არა'],'რეგულირების გადამხდელი')
							+panel('ათვისების გეგმა')
								table.table.table-hover.table-bordered.table-condensed
									thead
										tr.txt-capital
											th წელი
											th ასათვისებელი რესურსის ოდენობა
											th(ng-repeat='agc in atvisebisGegmaColumns')
												+textcell('',true)
											th(width='3%')
												a.btn.btn-sm.btn-info(ng-click='addAtvisebisGegmaColumn()') ► +
									tbody
										tr(ng-repeat='gi in gegmaItems')
											td
												+textcell('celi',true)
											td
												+numbercell('odenoba',true)
											td(ng-repeat='agc in atvisebisGegmaColumns')
													+numbercell('',true)
											td
												a.btn.btn-sm.btn-danger.pull-right(ng-click='removeGegmaItem(gi)') X
										tr
											td(colspan='{{(atvisebisGegmaColumns.length + 2)}}')
											td
												a.btn.btn-sm.btn-success.pull-right(ng-click='addGegmaItem()') ▼ +
							+panel('ლიცენზიის წარმოქმნის საფუძველი')
								tabset
									+tab('აუქციონი')
										+textbox('aukcionisNomeri','აუქციონის N','',true)
										+textbox('lotisNomeri','ლოტის N','',true)
										+textbox('ganacxadisNomeri','განაცხადის N','',true)
										+numberbox('sackisiFasi','საწყისი ფასი','',true)
										+numberbox('sabolooFasi','საბოლოო ფასი','',true)
									+tab('საბჭოს წესით გადაცემული')
										+datepicker('tarigi','თარიღი','',true)
										+textbox('okmisNomeri','ოქმის N','',true)
									+tab('გაყოფა')
										+textbox('dzveliLicenziisNomeri','ძველი ლიცენზიის N','',true)
									+tab('გადაცემა')
										+textbox('dzveliLicenziisNomeri','ძველი ლიცენზიის N','',true)
									+tab('დუბლიკატი')
										+textbox('dzveliLicenziisNomeri','ძველი ლიცენზიის N','',true)
									+tab('იჯარით გადაცემა')
										+textbox('moijarisPid','საიდენთიფიკაციო კოდი','ან მოიჯარის პირადი ნომერი',true)
										+textbox('dasaxeleba','დასახელება','ან მოიჯარის პირის სახელი, გვარი',true)
										+fileUpload('moijarisFailebi','*',true,'მიბმული ფაილები',true)
							+panel('ლიცენზიის გაუქმების საფუძველი')
								tabset
									+tab('პირადი განცხადება')
										+fileUpload('mibmuliFailebi','*',true,'მიბმული ფაილები',true)
									+tab('სააგენტოს გადაწყვეტილება')
										+fileUpload('mibmuliFailebi','*',true,'მიბმული ფაილები',true)
									+tab('გაყოფა')
										+textbox('axaliLicenziisNomeri','ახალი ლიცენზიის N','',true)
									+tab('გადაცემა')
										+textbox('axaliLicenziisNomeri','ახალი ლიცენზიის N','',true)
									+tab('დუბლიკატი')
										+textbox('axaliLicenziisNomeri','ახალი ლიცენზიის N','',true)
						div.col-md-12
							button.btn.btn-success.pull-right.txt-capital(type='submit') რეგისტრაცია
		hr
		.jumbotron.jumbotron-sm
			.container
				.row
					.col-sm-12.col-lg-12
						h4.txt-capital © გარემოს ეროვნული სააგენტო