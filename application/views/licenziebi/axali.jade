extends ../index.jade
include ../mixins/basic-controls.jade
include ../mixins/form-controls.jade
include ../mixins/grid-controls.jade

block content
	div(ng-controller='axaliCtrl')
		script.
				var axaliCtrl = function($scope, $modal, $log){
					$scope.licenzia = {
						licenziantisMonacemebi:{
							pid:null,
							dasaxeleba:null,
							faktMisamarti:null,
							iurMisamarti:null,
							tel:null,
							mail:null
						},
						carmomadgeneli:null,
						informaciaObiektisShesaxeb:{}
					};
					$scope.submit = function(){
						console.log($scope.licenzia);
					};
					$scope.atvisebisGegmaColumns = [];
					$scope.resursebi = [
						{dasaxeleba:'',raodenoba:0,zomisErteuli:null,gamokenebisSfero:''}
					];
					$scope.gegmaItems = [
						{celi:'',odenoba:0}
					];
					$scope.addResursi = function(){
						$scope.resursebi.push({dasaxeleba:'',raodenoba:0,zomisErteuli:null,gamokenebisSfero:''});
					};
					$scope.addAtvisebisGegmaColumn = function(){
						$scope.atvisebisGegmaColumns.push({});
					};
					$scope.addGegmaItem = function(){
						$scope.gegmaItems.push({celi:'',odenoba:0});
					};
					$scope.removeResursi = function(res){
						var i = $scope.resursebi.indexOf(res);
						$scope.resursebi.splice(i,1);
					};
					$scope.removeGegmaItem = function(gi){
						var i = $scope.gegmaItems.indexOf(gi);
						$scope.gegmaItems.splice(i,1);
					};
					$scope.open = function () {
							var modalInstance = $modal.open({
									templateUrl: '/templates/licenziebi/carmomadgeneli.jade',
									controller: modalInstanceCtrl,
									resolve:{
										carmomadgeneli: function(){
											return {
												pid:null,
												saxeli:null,
												gvari:null,
												tel:null,
												mail:null
											};
										}
									}
							});
							modalInstance
								.result
								.then(function (carmomadgeneli) {
									$scope.licenzia.carmomadgeneli = carmomadgeneli;
								});
					};
				};
				var modalInstanceCtrl = function ($scope, $modalInstance,carmomadgeneli) {
						$scope.carmomadgeneli = carmomadgeneli;
						$scope.ok = function () {
							$modalInstance.close($scope.carmomadgeneli);
						};
						$scope.cancel = function () {
							$modalInstance.dismiss('cancel');
						};
				};
		.jumbotron.jumbotron-sm
			.container
				.row
					.col-sm-12.col-lg-12
						h2.txt-capital ახალი ლიცენზია
		.container
			.row
				form.form-horizontal(method='POST',enctype='multipart/form-data')
					div.col-md-12
						+panel('ლიცენზიანტის მონაცემები',4)
							+textbox('licenzia.licenziantisMonacemebi.pid','საიდენთიფიკაციო კოდი','ან ფიზიკური პირის პირადი ნომერი',true)
							+textbox('licenzia.licenziantisMonacemebi.dasaxeleba','დასახელება','ან ფიზიკური პირის სახელი, გვარი',true)
							+textbox('licenzia.licenziantisMonacemebi.faktMisamarti','ფაქტიური მისამართი','მაგ: წერეთლის #144',true)
							+textbox('licenzia.licenziantisMonacemebi.iurMisamarti','იურიდიული მისამართი','მაგ: წერეთლის #144',true)
							+specInput('licenzia.licenziantisMonacemebi.tel','phone','phone','ტელეფონი','მაგ: 599123456',true)
							+specInput('licenzia.licenziantisMonacemebi.mail','email','envelope','e-ფოსტა','მაგ: someone@mail.com',true)
							+fileUpload('licenzia.licenziantisMonacemebi.mibmuliFailebi','*',true,'მიბმული ფაილები')
						hr
						a.btn.btn-default.txt-capital(ng-click='open()') წარმომადგენელი პირი
						hr
						+panel('ინფორმაცია ობიექტის შესახებ',4)
							div.col-md-6
								+typeahead('regioni',regionebi,'რეგიონი')
								+typeahead('municipaliteti',municipalitetebi,'მუნიციპალიტეტი')
								+textbox('dasaxlebuliPunkti','დასახლებული პუნქტი','')
							div.col-md-6
								+combobox('fartobiUom',fartobiUoms,'ფართობის საზომი ერთეული')
								+numberbox('fartobi','ფართობი','')
							div.col-md-12
								+panel('რესურსები')
									table.table.table-hover.table-bordered.table-condensed
										thead
											tr.txt-capital
												th(width='37%') დასახელება
												th(width='10%') რაოდენობა
												th(width='15%') ზომის ერთეული
												th(width='35%') გამოყენების სფერო
												th(width='3%')
										tbody
											tr(ng-repeat='res in resursebi')
												td
													+typeaheadCell('resursisDasaxeleba',resursebi)
												td
													+numbercell('resursisRaodenoba')
												td
													+combocell('resursisUom',uoms)
												td
													+textcell('gamokenebisSfero')
												td
													a.btn.btn-sm.btn-danger.pull-right(ng-click='removeResursi(res)') X
											tr
												td(colspan='4')
												td
													a.btn.btn-sm.btn-success.pull-right(ng-click='addResursi()') +
						+panel('ინფორმაცია ლიცენზიის შესახებ',4)
							+textbox('licenziisNomeri','ლიცენზიის N','')
							+datepicker('licenziisGacemisTarigi','გაცემის თარიღი')
							+textbox('brdzanebisNomeri','ბრძანების N','')
							+datepicker('brdzanebisTarigi','ბრძანების თარიღი')
							+numberbox('moqmedebisVada','მოქმედების ვადა','წლებში (მაგ: 5)')
							+bigtext('salicenzioPirobebi',5,10,'სალიცენზიო პირობები')
							+combobox('licenziisStatusi',statusebi,'ლიცენზიის სტატუსი')
							+fileUpload('licenziaFailebi','*',true,'ფაილები')
						+panel('დამატებითი ინფორმაცია',4)
							+fileUpload('ruqa','image/*',true,'რუქა')
							+numberbox('a','a','')
							+numberbox('b','b','')
							+numberbox('c1','c1','')
							+numberbox('c2','c2','')
							+numberbox('p','p','')
							+fileUpload('geoSainformacioPaketi','*',true,'გეოსაინფორმაციო პაკეტი')
							+radio('regulirebisGadamxdeli',['კი','არა'],'რეგულირების გადამხდელი')
							+panel('ათვისების გეგმა')
								table.table.table-hover.table-bordered.table-condensed
									thead
										tr.txt-capital
											th წელი
											th ასათვისებელი რესურსის ოდენობა
											th(ng-repeat='agc in atvisebisGegmaColumns')
												+textcell('{{agc.name}}')
											th(width='3%')
												a.btn.btn-sm.btn-info(ng-click='addAtvisebisGegmaColumn()') ► +
									tbody
										tr(ng-repeat='gi in gegmaItems')
											td
												+textcell('celi')
											td
												+numbercell('odenoba')
											td(ng-repeat='agc in atvisebisGegmaColumns')
													+numbercell('{{agc.value}}')
											td
												a.btn.btn-sm.btn-danger.pull-right(ng-click='removeGegmaItem(gi)') X
										tr
											td(colspan='{{(atvisebisGegmaColumns.length + 2)}}')
											td
												a.btn.btn-sm.btn-success.pull-right(ng-click='addGegmaItem()') ▼ +
							+panel('ლიცენზიის წარმოქმნის საფუძველი')
								tabset
									+tab('აუქციონი')
										+textbox('aukcionisNomeri','აუქციონის N','')
										+textbox('lotisNomeri','ლოტის N','')
										+textbox('ganacxadisNomeri','განაცხადის N','')
										+numberbox('sackisiFasi','საწყისი ფასი','')
										+numberbox('sabolooFasi','საბოლოო ფასი','')
									+tab('საბჭოს წესით გადაცემული')
										+datepicker('tarigi','თარიღი','')
										+textbox('okmisNomeri','ოქმის N','')
									+tab('გაყოფა')
										+textbox('dzveliLicenziisNomeri','ძველი ლიცენზიის N')
									+tab('გადაცემა')
										+textbox('dzveliLicenziisNomeri','ძველი ლიცენზიის N')
									+tab('დუბლიკატი')
										+textbox('dzveliLicenziisNomeri','ძველი ლიცენზიის N')
									+tab('იჯარით გადაცემა')
										+textbox('moijarisPid','საიდენთიფიკაციო კოდი','ან მოიჯარის პირადი ნომერი')
										+textbox('dasaxeleba','დასახელება','ან მოიჯარის პირის სახელი, გვარი')
										+fileUpload('moijarisFailebi','*',true,'მიბმული ფაილები')
							+panel('ლიცენზიის გაუქმების საფუძველი')
								tabset
									+tab('პირადი განცხადება')
										+fileUpload('mibmuliFailebi','*',true,'მიბმული ფაილები')
									+tab('სააგენტოს გადაწყვეტილება')
										+fileUpload('mibmuliFailebi','*',true,'მიბმული ფაილები')
									+tab('გაყოფა')
										+textbox('axaliLicenziisNomeri','ახალი ლიცენზიის N','')
									+tab('გადაცემა')
										+textbox('axaliLicenziisNomeri','ახალი ლიცენზიის N','')
									+tab('დუბლიკატი')
										+textbox('axaliLicenziisNomeri','ახალი ლიცენზიის N','')
						div.col-md-12
							a.btn.btn-success.pull-right.txt-capital(ng-click='submit()') რეგისტრაცია
		hr
		.jumbotron.jumbotron-sm
			.container
				.row
					.col-sm-12.col-lg-12
						h4.txt-capital © გარემოს ეროვნული სააგენტო